{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">

    <!-- ✅ OBLIGATOIRE POUR MOBILE -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Profil Client | HexaQuébec</title>

    <!-- Bootstrap / AOS / FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
:root{
    --bg:#0f172a;
    --card:#1f2937;
    --gold:#c6a87d;
}
body{
    background:var(--bg);
    color:#fff;
    font-family:Montserrat,sans-serif;
}

/* CARDS */
.card-box{
    background:var(--card);
    border-radius:20px;
    padding:20px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
}

/* TOP BAR */
.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
}

/* BUTTON */
.btn-hexa{
    background:var(--gold);
    border:none;
    color:#0b132b;
    border-radius:30px;
    padding:8px 20px;
    font-weight:700;
}
.btn-hexa:hover{opacity:.9}

/* MESSAGES */
.bulle-client{
    background:#1c2a48;
    padding:12px;
    border-radius:15px;
}
.bulle-hexa{
    background:rgba(198,168,125,.2);
    border:1px solid var(--gold);
    padding:12px;
    border-radius:15px;
}

/* RESPONSIVE */
@media(max-width:768px){
    .top-bar{
        flex-direction:column;
        text-align:center;
    }
    h2{font-size:1.4rem}
    .btn-hexa{width:100%}
}
</style>
</head>

<body>

<div class="container py-4">

<!-- TOP BAR -->
<div class="card-box mb-4 top-bar">
    <div>
        <i class="fa fa-circle text-success"></i> En ligne
    </div>

    <div>
        <i class="fa fa-bell"></i>
        {% if notif_count > 0 %}
            <span class="badge bg-danger">{{ notif_count }}</span>
        {% endif %}
    </div>

    {% if request.user.is_authenticated %}
    <div>
        Bonjour {{ request.user.first_name }}
        <a href="{% url 'client_logout' %}" class="btn btn-hexa btn-sm ms-2">Déconnexion</a>
    </div>
    {% endif %}
</div>

<!-- PROFIL -->
<div class="row justify-content-center">
    <div class="col-12 col-md-7" data-aos="fade-up">
        <div class="card-box text-center">
            <h2>Profil Client</h2>
            <p class="mb-3">Bienvenue <strong>{{ client.user.first_name }}</strong></p>

            <button class="btn btn-hexa mb-3" onclick="toggleProfile()">Afficher le profil</button>

            <div id="profileInfo" style="display:none">
                <p><strong>Entreprise :</strong> {{ client.entreprise }}</p>
                <p><strong>Adresse :</strong> {{ client.adresse }}</p>
                <p><strong>Email :</strong> {{ client.user.email }}</p>
                <p><strong>N° Client :</strong> {{ client.numero_client }}</p>
            </div>
        </div>
    </div>
</div>

<!-- MESSAGES -->
<div class="row justify-content-center mt-4">
    <div class="col-12 col-md-8" data-aos="fade-up">
        {% for msg in messages_recu %}
            <div class="bulle-client mb-2">
                <strong>Vous :</strong><br>{{ msg.message }}
            </div>

            {% if msg.reponse %}
            <div class="bulle-hexa mb-3">
                <strong>HexaQuébec :</strong><br>{{ msg.reponse }}
            </div>
            {% endif %}
        {% empty %}
            <p class="text-muted text-center">Aucun message</p>
        {% endfor %}
    </div>
</div>

<!-- FORMULAIRES -->
<div class="row mt-4">
    <div class="col-12 col-md-4 mb-3">
        <div class="card-box">
            <h5>Message</h5>
            <form method="POST">
                {% csrf_token %}
                {{ message_form.as_p }}
                <button class="btn btn-hexa w-100">Envoyer</button>
            </form>
        </div>
    </div>

    <div class="col-12 col-md-4 mb-3">
        <div class="card-box">
            <h5>Rendez-vous</h5>
            <form method="POST">
                {% csrf_token %}
                {{ rdv_form.as_p }}
                <button class="btn btn-hexa w-100">Envoyer</button>
            </form>
        </div>
    </div>

    <div class="col-12 col-md-4 mb-3">
        <div class="card-box">
            <h5>Partenariat</h5>
            <form method="POST">
                {% csrf_token %}
                {{ partenaire_form.as_p }}
                <button class="btn btn-hexa w-100">Envoyer</button>
            </form>
        </div>
    </div>
</div>

</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
AOS.init();
function toggleProfile(){
    const el=document.getElementById("profileInfo");
    el.style.display=el.style.display==="none"?"block":"none";
}
</script>

</body>
</html>
