{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Profil Client | HexaQu√©bec</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap / AOS / FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

    <style>
        :root {
            --bg: #0f172a;
            --card-bg: #0f172a;
            --text: #fff;
            --text-light: #94a3b8;
        }

        .dark-mode {
            --bg: #0b132b;
            --card-bg: #1f2937;
            --text: #f1f5f9;
            --text-light: #cbd5e1;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Montserrat', sans-serif;
        }

        /* ===== CARDS ===== */
        .profile-card, .form-card, .messages-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        h2, h5 {
            color: #c6a87d;
            font-weight: 700;
        }

        .welcome-msg {
            font-size: 1.1rem;
            color: #f0d49d;
        }

        .info-box {
            background: rgba(255,255,255,0.08);
            padding: 18px;
            border-radius: 15px;
        }

        .label {
            color: #c6a87d;
            font-weight: 600;
        }

        /* ===== TOP BAR ===== */
        .top-bar-profile {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: var(--card-bg);
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .notif-icon {
            font-size: 22px;
            position: relative;
        }

        .notif-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #ef4444;
            color: white;
            padding: 3px 6px;
            border-radius: 50%;
            font-size: 11px;
        }

        .btn-hexa {
            background: #c6a87d;
            color: #0b132b;
            border-radius: 30px;
            font-weight: 700;
        }

        /* ===== MESSAGES ===== */
        .bulle-client {
            background: #1c2a48;
            padding: 12px;
            border-radius: 15px;
            margin-bottom: 6px;
        }

        .bulle-hexa {
            background: rgba(198,168,125,0.2);
            border: 1px solid #c6a87d;
            color: #c6a87d;
            padding: 12px;
            border-radius: 15px;
            margin-left: auto;
            margin-bottom: 6px;
        }

        .msg-date {
            font-size: 11px;
            opacity: 0.7;
        }

        input, textarea, select {
            background: rgba(255,255,255,0.1);
            border: 1px solid #c6a87d;
            color: white;
            border-radius: 10px;
            padding: 10px;
            width: 100%;
        }

        /* üì± RESPONSIVE MOBILE */
        @media (max-width: 768px) {
            .top-bar-profile {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            h2 { font-size: 1.4rem; text-align: center; }
            .welcome-msg { text-align: center; }

            .btn-hexa { width: 100%; }
        }
        /* üì± RESPONSIVE MOBILE AM√âLIOR√â */
@media (max-width: 768px) {

    body {
        font-size: 15px;
    }

    .container {
        padding-left: 12px;
        padding-right: 12px;
    }

    /* Top bar */
    .top-bar-profile {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }

    .top-bar-profile > div {
        justify-content: center !important;
    }

    /* Titres */
    h2 {
        font-size: 1.35rem;
        text-align: center;
    }

    h5 {
        font-size: 1.1rem;
        text-align: center;
    }

    .welcome-msg {
        text-align: center;
        font-size: 1rem;
    }

    /* Cards */
    .profile-card,
    .form-card {
        padding: 18px;
        border-radius: 16px;
    }

    /* Colonnes pleine largeur */
    .col-md-7,
    .col-md-8,
    .col-md-4 {
        width: 100%;
    }

    /* Boutons */
    .btn-hexa {
        width: 100%;
        padding: 10px;
        font-size: 0.95rem;
    }

    /* Messages */
    .bulle-client,
    .bulle-hexa {
        max-width: 100%;
        font-size: 0.95rem;
    }

    .bulle-hexa {
        margin-left: 0;
    }

    .msg-date {
        font-size: 10px;
    }

    /* Formulaires */
    input,
    textarea,
    select {
        font-size: 0.95rem;
    }
}

    </style>
</head>
<body>
<div class="container py-5">

    <!-- üí¨ Messages de confirmation -->
    {% if messages %}
        <div class="row justify-content-center">
            <div class="col-md-7">
                {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert" style="border-radius:10px;">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- üü¢ TOP BAR PROFIL -->
    <div class="top-bar-profile">
        <div class="user-status d-flex align-items-center gap-2">
            <span class="status-dot" id="onlineDot"></span>
            <span id="statusText">Statut...</span>
        </div>

        <div class="notif-icon position-relative me-3">
            <i class="fa fa-bell"></i>
            {% if notif_count > 0 %}
            <span class="notif-badge">{{ notif_count }}</span>
            {% endif %}
        </div>

        {% if request.user.is_authenticated %}
        <div class="d-flex align-items-center gap-2">
            <span>Bonjour {{ request.user.first_name }}</span>
            <a href="{% url 'client_logout' %}" class="btn btn-hexa btn-sm">D√©connexion</a>
        </div>
        {% endif %}
    </div>

    <!-- üë§ Profil Client -->
    <div class="row justify-content-center">
        <div class="col-md-7 profile-card" data-aos="fade-up">
            <h2>Profil Client</h2>
            <p class="welcome-msg">Bienvenue, <strong>{{ client.user.first_name }}</strong></p>

            <button class="btn btn-hexa mb-3" id="toggleProfile">Afficher le profil</button>

            <div class="info-box" id="profileInfo" style="display: none;">
                <p><span class="label">Entreprise :</span> {{ client.entreprise }}</p>
                <p><span class="label">Adresse :</span> {{ client.adresse }}</p>
                <p><span class="label">Contact :</span> {{ client.contact }}</p>
                <p><span class="label">Courriel :</span> {{ client.user.email }}</p>
                <p><span class="label">Num√©ro client :</span>
                    <strong style="color:#f0d49d;">{{ client.numero_client }}</strong>
                </p>
            </div>
        </div>
    </div>

    <!-- Liste des messages -->
    <div class="row justify-content-center mt-4">
        <div class="col-md-8" data-aos="fade-up">
            {% if messages_recu %}
                {% for msg in messages_recu %}
                    <div class="bulle-client">
                        <strong>Vous :</strong><br>{{ msg.message }}
                    </div>
                    <p class="msg-date text-start">{{ msg.date }}</p>

                    {% if msg.reponse %}
                        <div class="bulle-hexa">
                            <strong>HexaQu√©bec :</strong><br>{{ msg.reponse }}
                        </div>
                        <p class="msg-date text-end">{{ msg.date_reponse }}</p>
                    {% else %}
                        <p class="text-muted"><em>En attente de r√©ponse...</em></p>
                    {% endif %}
                    <hr style="border-color: rgba(255,255,255,0.08);">
                {% endfor %}
            {% else %}
                <p class="text-muted">Aucun message pour le moment.</p>
            {% endif %}
        </div>
    </div>

    <!-- üìù Formulaires -->
    <div class="row justify-content-center mt-4">
        <div class="col-md-4 mb-4" data-aos="fade-up">
            <div class="form-card">
                <h5>Envoyer un message</h5>
                <form method="POST" action="">
                    {% csrf_token %}
                    {{ message_form.as_p }}
                    <button type="submit" name="send_message" value="1" class="btn btn-hexa mt-2 w-100">Envoyer</button>
                </form>
            </div>
        </div>

        <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="200">
            <div class="form-card">
                <h5>Demande de rendez-vous</h5>
                <form method="POST">
                    {% csrf_token %}
                    {{ rdv_form.as_p }}
                    <button type="submit" name="send_rdv" class="btn btn-hexa mt-2 w-100">Envoyer</button>
                </form>
            </div>
        </div>

        <div class="col-md-4 mb-4" data-aos="fade-up" data-aos-delay="400">
            <div class="form-card">
                <h5>Demande de partenariat</h5>
                <form method="POST">
                    {% csrf_token %}
                    {{ partenaire_form.as_p }}
                    <button type="submit" name="send_partenaire" class="btn btn-hexa mt-2 w-100">Envoyer</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
    AOS.init();

    // Mode sombre automatique
    const hour = new Date().getHours();
    if (hour >= 19 || hour <= 6) document.body.classList.add("dark-mode");

    // Statut en ligne / hors ligne
    function updateStatus() {
        const dot = document.getElementById("onlineDot");
        const text = document.getElementById("statusText");
        if (navigator.onLine) { dot.style.background = "#22c55e"; text.textContent = "En ligne"; }
        else { dot.style.background = "#ef4444"; text.textContent = "Hors ligne"; }
    }
    updateStatus();
    window.addEventListener("online", updateStatus);
    window.addEventListener("offline", updateStatus);

    // Afficher / cacher profil
    const toggleBtn = document.getElementById("toggleProfile");
    const profileInfo = document.getElementById("profileInfo");
    toggleBtn.addEventListener("click", () => {
        if (profileInfo.style.display === "none") {
            profileInfo.style.display = "block";
            toggleBtn.textContent = "Cacher le profil";
        } else {
            profileInfo.style.display = "none";
            toggleBtn.textContent = "Afficher le profil";
        }
    });
</script>
</body>
</html>
